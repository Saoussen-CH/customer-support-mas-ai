{
  "eval_set_id": "sequential_agent_tests",
  "description": "Tests for SequentialAgent refund workflow with validation gates",
  "eval_cases": [
    {
      "eval_id": "refund_workflow_valid_order_with_reason",
      "description": "Valid order with explicit reason - should pass all 3 validation gates",
      "conversation": [
        {
          "user_content": {
            "parts": [{"text": "I want a refund for order ORD-12345 because the laptop arrived damaged"}],
            "role": "user"
          },
          "final_response": {
            "parts": [{"text": "refund"}],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "name": "PreloadMemoryTool",
                "args": {}
              },
              {
                "name": "refund_workflow",
                "args": {"request": "I want a refund for order ORD-12345 because the laptop arrived damaged"}
              }
            ]
          }
        }
      ]
    },
    {
      "eval_id": "refund_workflow_in_transit_order",
      "description": "In-transit order eligible for cancellation - should pass validation",
      "conversation": [
        {
          "user_content": {
            "parts": [{"text": "I'd like to cancel my order ORD-12345 as I ordered the wrong model"}],
            "role": "user"
          },
          "final_response": {
            "parts": [{"text": "cancel"}],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "name": "PreloadMemoryTool",
                "args": {}
              },
              {
                "name": "refund_workflow",
                "args": {"request": "I'd like to cancel my order ORD-12345 as I ordered the wrong model"}
              }
            ]
          }
        }
      ]
    },
    {
      "eval_id": "refund_workflow_invalid_order",
      "description": "Non-existent order - should fail at Step 1 (validate_order_id)",
      "conversation": [
        {
          "user_content": {
            "parts": [{"text": "I want a refund for order ORD-99999 because it's defective"}],
            "role": "user"
          },
          "final_response": {
            "parts": [{"text": "not found"}],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "name": "PreloadMemoryTool",
                "args": {}
              },
              {
                "name": "refund_workflow",
                "args": {"request": "I want a refund for order ORD-99999 because it's defective"}
              }
            ]
          }
        }
      ]
    },
    {
      "eval_id": "refund_workflow_delivered_order_with_reason",
      "description": "Delivered order within return window with reason - should pass",
      "conversation": [
        {
          "user_content": {
            "parts": [{"text": "I need to return order ORD-67890 because the headphones have defective audio"}],
            "role": "user"
          },
          "final_response": {
            "parts": [{"text": "refund"}],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "name": "PreloadMemoryTool",
                "args": {}
              },
              {
                "name": "refund_workflow",
                "args": {"request": "I need to return order ORD-67890 because the headphones have defective audio"}
              }
            ]
          }
        }
      ]
    },
    {
      "eval_id": "refund_workflow_order_past_return_window",
      "description": "Order past 30-day return window - should fail at Step 2 (check_refund_eligibility)",
      "conversation": [
        {
          "user_content": {
            "parts": [{"text": "I want to return order ORD-11111 because it's not comfortable"}],
            "role": "user"
          },
          "final_response": {
            "parts": [{"text": "not eligible"}],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "name": "PreloadMemoryTool",
                "args": {}
              },
              {
                "name": "refund_workflow",
                "args": {"request": "I want to return order ORD-11111 because it's not comfortable"}
              }
            ]
          }
        }
      ]
    },
    {
      "eval_id": "refund_workflow_missing_reason",
      "description": "Order ID without reason - agent should ask for reason before calling workflow",
      "conversation": [
        {
          "user_content": {
            "parts": [{"text": "Can I get a refund for ORD-12345?"}],
            "role": "user"
          },
          "final_response": {
            "parts": [{"text": "reason"}],
            "role": "model"
          }
        }
      ]
    },
    {
      "eval_id": "refund_workflow_sequential_validation",
      "description": "Test sequential execution: Step 1 (validate) → Step 2 (eligibility) → Step 3 (process)",
      "conversation": [
        {
          "user_content": {
            "parts": [{"text": "Process refund for ORD-22222, item was wrong size"}],
            "role": "user"
          },
          "final_response": {
            "parts": [{"text": "processed"}],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "name": "PreloadMemoryTool",
                "args": {}
              },
              {
                "name": "refund_workflow",
                "args": {"request": "Process refund for ORD-22222, item was wrong size"}
              }
            ]
          }
        }
      ]
    }
  ]
}
