%% Billing Agent Architecture
%% Google Cloud Platform Style

graph TB
    subgraph "Billing Agent"
        Agent[üí≥ Billing Agent<br/>Model: Gemini 2.5 Flash<br/>Callback: auto_save_to_memory_explicit]
        Note[‚ö†Ô∏è NOTE: Refunds processed<br/>via refund_workflow only<br/>NOT available directly]
    end

    subgraph "Tools"
        T0[PreloadMemoryTool<br/>Load user memories]
        T1[get_invoice<br/>Get by invoice ID]
        T2[get_invoice_by_order_id<br/>Get by order ID]
        T3[check_payment_status<br/>Payment status check]
    end

    subgraph "Data Sources"
        Firestore[(Firestore<br/>Invoices/Payments)]
        Memory[(Memory Bank)]
    end

    Agent --> T0
    Agent --> T1
    Agent --> T2
    Agent --> T3

    T0 --> Memory
    T1 --> Firestore
    T2 --> Firestore
    T3 --> Firestore

    style Agent fill:#FBBC04,stroke:#F29900,color:#000,stroke-width:3px
    style Note fill:#EA4335,stroke:#C5221F,color:#fff,stroke-width:2px
    style T0 fill:#9334E6,stroke:#7627BB,color:#fff
    style T1 fill:#4285F4,stroke:#1967D2,color:#fff
    style T2 fill:#4285F4,stroke:#1967D2,color:#fff
    style T3 fill:#4285F4,stroke:#1967D2,color:#fff
    style Firestore fill:#FF6F00,stroke:#E65100,color:#fff
    style Memory fill:#9334E6,stroke:#7627BB,color:#fff
